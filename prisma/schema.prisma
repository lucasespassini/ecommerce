// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

enum Permissao {
  CLIENTE
  VENDEDOR
}

model Usuario {
  usr_id                      String                     @id @db.Char(26)
  usr_nome                    String                     @db.VarChar(100)
  usr_valor_saldo             Int                        @default(0) @db.UnsignedMediumInt
  usr_email                   String                     @unique @db.VarChar(100)
  usr_senha                   String                     @db.VarChar(100)
  usr_permissao               Permissao
  vendedor                    Vendedor?
  usuario_depositos_historico UsuarioDepositoHistorico[]
  compras                     Compra[]

  @@map("usuarios")
}

model Vendedor {
  vdd_id        String    @id @db.Char(26)
  vdd_usr_id    String    @unique @db.Char(26)
  vdd_nome      String    @db.VarChar(100)
  vdd_avaliacao Int       @default(0) @db.UnsignedTinyInt
  usuario       Usuario   @relation(fields: [vdd_usr_id], references: [usr_id])
  produtos      Produto[]

  @@map("vendedores")
}

model UsuarioDepositoHistorico {
  cdh_id     String   @id @db.Char(26)
  cdh_usr_id String   @db.Char(26)
  cdh_valor  Int      @db.UnsignedSmallInt
  cdh_data   DateTime @default(dbgenerated("CURRENT_TIMESTAMP")) @db.DateTime
  usuario    Usuario  @relation(fields: [cdh_usr_id], references: [usr_id])

  @@map("usuario_deposito_historico")
}

model Compra {
  cmp_ordem_id           String               @unique @db.Char(26)
  cmp_usr_id             String               @db.Char(26)
  cmp_prd_id             String               @db.Char(26)
  cmp_pvv_id             String               @db.Char(26)
  cmp_data               DateTime             @db.DateTime
  usuario                Usuario              @relation(fields: [cmp_usr_id], references: [usr_id])
  produto                Produto              @relation(fields: [cmp_prd_id], references: [prd_id])
  produto_vigencia_valor ProdutoVigenciaValor @relation(fields: [cmp_pvv_id], references: [pvv_id])

  @@id([cmp_usr_id, cmp_prd_id])
  @@map("compras")
}

model Produto {
  prd_id                   String                 @id @db.Char(26)
  prd_vdd_id               String                 @db.Char(26)
  prd_nome                 String                 @db.VarChar(50)
  prd_avaliacao            Int                    @default(0) @db.UnsignedTinyInt
  prd_estoque              Int                    @default(0) @db.UnsignedSmallInt
  vendedor                 Vendedor               @relation(fields: [prd_vdd_id], references: [vdd_id])
  compras                  Compra[]
  produto_vigencia_valores ProdutoVigenciaValor[]

  @@map("produtos")
}

model ProdutoVigenciaValor {
  pvv_id             String   @id
  pvv_prd_id         String   @db.Char(26)
  pvv_valor_vigencia Int      @db.SmallInt
  pvv_data_inicio    DateTime @default(dbgenerated("CURRENT_TIMESTAMP")) @db.DateTime
  produto            Produto  @relation(fields: [pvv_prd_id], references: [prd_id])
  compras            Compra[]

  @@map("produto_valor_vigencia")
}
